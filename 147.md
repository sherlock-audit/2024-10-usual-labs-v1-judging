Wide Daisy Fly

Medium

# # M-1 : If Admin Account Is Hacked All The USD0 Tokens In The USD0PP Contract Can Be Easily Stolen

### Summary

## Summary 
In an emergency case the admin with (DEFAULT_ADMIN_ROLE) can withdraw all the usd0 tokens to a safe address by calling the [Usd0PP::emergencyWithdraw()](https://github.com/sherlock-audit/2024-10-usual-labs-v1/blob/main/pegasus/packages/solidity/src/token/Usd0PP.sol#L400-L416) method however if anyone compromises admin's eoa all the usd0 tokens can be easily stolen.


### Root Cause

Considering the following implementation:
```solidity
 function emergencyWithdraw(address safeAccount) external {
        Usd0PPStorageV0 storage $ = _usd0ppStorageV0();

        if (!$.registryAccess.hasRole(DEFAULT_ADMIN_ROLE, msg.sender)) {
            revert NotAuthorized();
        }
        IERC20 usd0 = $.usd0;

        uint256 balance = usd0.balanceOf(address(this));
        // get the collateral token for the bond
        usd0.safeTransfer(safeAccount, balance);

        // Pause the contract
        _pause();

        emit EmergencyWithdraw(safeAccount, balance);
    }
```
Once this function is invoked by Admin, it will send all the usd0 token's in the contract to an arbitrary address given by admin and won't revert unless 
the destination is 0 address because of following lines 
```solidity   
        uint256 balance = usd0.balanceOf(address(this));
        // get the collateral token for the bond
        usd0.safeTransfer(safeAccount, balance);
```
However since any arbitrary address is accepted and all the USD0 tokens are transferred by this function in case admin is hacked all the funds can be directly transferred to the eoa of attacker.

### Internal pre-conditions

Attacker should call `USD0PP::emergencyWithdraw()` function without 0 address as parameter.


### External pre-conditions

Attacker should obtain the admin's private key by fishing or another social engineering method in order to have  `DEFAULT_ADMIN_ROLE`.


### Attack Path

As described above once the admin account is compromised, attacker can directly steal all the USD0 tokens in USD0PP contract by calling  emergencyWithdraw function with his eoa as parameter.

### Impact

USD0 tokens are used as collateral for minting bonds as [USD0PP::mint()](https://github.com/sherlock-audit/2024-10-usual-labs-v1/blob/main/pegasus/packages/solidity/src/token/Usd0PP.sol#L211-L228) function demonstrates. In case this attack occurs, many users will loose all of their collateral.

### PoC

This issue can be regenerated by adding ` function emergencyWithdraw(address safeAccount) external`  to [IUSD0PP interface](https://github.com/sherlock-audit/2024-10-usual-labs-v1/blob/main/pegasus/packages/solidity/src/interfaces/token/IUsd0PP.sol) then pasting the code below to [Usd0PP.t.sol](https://github.com/sherlock-audit/2024-10-usual-labs-v1/blob/main/pegasus/packages/solidity/test/token/Usd0PP.t.sol).
 
 ```solidity
    function testMaliciousAdminCanStealFundsByCallingEmergencyWithdraw() public{
        // get bond with symbol USD0PP A0
        IUsd0PP usd0PP180 = IUsd0PP(registryContract.getContract(CONTRACT_USD0PP));
        uint256 amount = 100e18;
        address compromisedAddressByAttacker=admin; //assuming attacker compromised admin's eoa 
        address attacker = makeAddr('Attacker');
        deal(address(stbcToken), address(usd0PP180), amount); //assume that USD0pp contract has 100 sbtc tokens  
        uint256 bal = stbcToken.balanceOf(address(usd0PP180));
        assertGt(bal, 0);
        vm.prank(compromisedAddressByAttacker);
        usd0PP180.emergencyWithdraw(attacker);
        assertEq(stbcToken.balanceOf(attacker), bal);
    }
```
The Final step is submitting `forge test --mt testMaliciousAdminCanStealFundsByCallingEmergencyWithdraw` on terminal from the same path with `Usd0PP.t.sol`.

### Mitigation

_No response_